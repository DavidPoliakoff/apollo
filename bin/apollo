#!/usr/bin/env python

import sys
import os
import argparse
import logging

# Get path set up
RLSL_FILE = os.path.realpath(os.path.expanduser(__file__))
RLSL_PREFIX = os.path.dirname(os.path.dirname(RLSL_FILE))
RLSL_LIB_PATH = RLSL_PREFIX
sys.path.insert(0, RLSL_LIB_PATH)


def main():
    logging.basicConfig(filename='example.log',level=logging.DEBUG,
                        format='%(asctime)s %(name)-12s %(levelname)-8s %(message)s')

    parser = argparse.ArgumentParser()
    subparsers = parser.add_subparsers(metavar='SUBCOMMAND', dest="command")

    import apollo.cmd
    for cmd in apollo.cmd.commands:
        module = apollo.cmd.get_module(cmd)
        subparser = subparsers.add_parser(cmd, help=module.description)
        module.setup_parser(subparser)

    if len(sys.argv) == 1:
        parser.print_help()
        sys.exit(1)

    args = parser.parse_args()

    command = apollo.cmd.get_command(args.command)

    command(parser, args)


if __name__ == '__main__':
    main()
